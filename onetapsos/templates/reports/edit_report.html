{% extends "base.html" %}

{% block title %}Edit Report - OneTapSOS{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto p-8 space-y-8">

    <!-- Report Summary -->
    <div class="space-y-2 text-center">
        <div><strong>Report ID:</strong> {{ report.report_id }}</div>
        <div><strong>Date & Time Reported:</strong> {{ report.date_time_reported|date:"Y-m-d h:i A" }}</div>
        <div><strong>Location:</strong> {{ report.location }}</div>
        <div><strong>Sender:</strong> {{ report.sender }}</div>
    </div>

    <div class="p-4 bg-gray-100 rounded-lg text-center whitespace-pre-wrap">
        {{ report.message|default:"No message provided." }}
    </div>

    <!-- Edit Form -->
    <form method="POST" class="space-y-6">
        {% csrf_token %}

        <div class="grid grid-cols-1 gap-4">
            {% if report.status != "unclassified" %}
            <!-- Crime Category -->
            <div>
                <label for="crime_category" class="block mb-1 font-medium text-gray-700">Crime Category:</label>
                <select id="crime_category" name="crime_category" class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
                    {% for choice in crime_choices %}
                        <option value="{{ choice.0 }}" {% if report.crime_category == choice.0 %}selected{% endif %}>
                            {{ choice.1 }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            {% endif %}

            <!-- Status -->
            <div>
                <label for="status" class="block mb-1 font-medium text-gray-700">Status:</label>
                <select id="status" name="status" class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
                    {% for status in status_choices %}
                        <option value="{{ status.0 }}" {% if report.status == status.0 %}selected{% endif %}>
                            {{ status.1 }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            {% if report.status == "active" or report.status == "resolved" %}
            <!-- Date Responded -->
            <div>
                <label for="date_responded" class="block mb-1 font-medium text-gray-700">Date and Time Responded:</label>
                <input type="datetime-local" id="date_responded" name="date_responded"
                       value="{{ report.date_time_responded|default_if_none:''|date:'Y-m-d\\TH:i' }}"
                       class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
            </div>

            <!-- Assigned Officers -->
            <div>
                <label for="officers" class="block mb-1 font-medium text-gray-700">Officer Responded:</label>
                <select id="officers" name="officers" multiple size="5" class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
                    {% for officer in officer_choices %}
                        <option value="{{ officer.id }}" {% if officer in report.officers_responded.all %}selected{% endif %}>
                            {{ officer.first_name }} {{ officer.last_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <!-- Date Resolved -->
            <div>
                <label for="date_resolved" class="block mb-1 font-medium text-gray-700">Date Resolved:</label>
                <input type="datetime-local" id="date_resolved" name="date_resolved"
                       value="{{ report.date_time_resolved|default_if_none:''|date:'Y-m-d\\TH:i' }}"
                       class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
            </div>
            {% endif %}

            {% if report.status == "rejected" %}
            <!-- Rejection Reason -->
            <div>
                <label for="rejection_reason" class="block mb-1 font-medium text-gray-700">Rejection Reason:</label>
                <input type="text" id="rejection_reason" name="rejection_reason"
                       value="{{ report.rejection_reason|default:'' }}"
                       class="w-full p-2 rounded border border-gray-300 focus:outline-none focus:ring-2 focus:ring-[#4B7289]">
            </div>

            <div><strong>Rejected On:</strong> {{ report.date_time_rejected|date:"Y-m-d h:i A" }}</div>
            <div><strong>Days Remaining:</strong> {{ days_remaining }}</div>
            {% endif %}
        </div>

        <!-- Buttons -->
        <div class="flex justify-center gap-4">
            <button type="submit" class="px-6 py-2 bg-[#4B7289] text-white rounded hover:bg-[#6B7280] transition border-glow">SAVE</button>
            <a href="{% url 'report_view' report.report_id %}" class="px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition border-glow">â—€ Undo Changes</a>
        </div>

    </form>
</div>
{% endblock %}
