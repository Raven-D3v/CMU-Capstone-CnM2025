{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{% block title %}OneTapSOS{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs" defer></script>
    <style>
        .border-glow {
            border: 1px solid #4B7289;
            transition: border-color 0.3s ease;
        }
        .border-glow:hover {
            border-color: #6B7280;
        }
        .text-glow {
            text-shadow: 0 0 2px rgba(75, 114, 137, 0.5);
        }
    </style>
</head>

<body class="bg-[#E5E7EB] text-gray-800 font-sans" x-data="{ open: false }">

    <div class="flex flex-col min-h-screen">

        <!-- Header -->
        <header class="flex justify-between items-center p-4 bg-[#1B263B]/90 shadow-md border-b border-gray-300">
            <div class="flex items-center gap-4">
                <!-- Mobile hamburger -->
                <button @click="open = !open" class="md:hidden text-white focus:outline-none">â˜°</button>

                <img src="/static/img/NEPS_Logo.png" alt="Station Logo"
                    class="w-12 h-12 sm:w-16 sm:h-16 object-cover">
                <div class="text-base sm:text-lg font-medium text-white text-glow leading-tight">
                    Malabon City - Police Sub Station 5 <br class="sm:hidden"> (Longos)
                </div>
            </div>

            <!-- Notifications -->
            <div class="relative" x-data="{ showNotif: false }">
                <button @click="showNotif = !showNotif" class="relative text-white focus:outline-none">
                    ðŸ””
                    {% if unread_count > 0 %}
                        <span x-ref="badge"
                            class="absolute -top-1 -right-2 bg-red-600 text-white text-xs font-bold px-1.5 py-0.5 rounded-full">
                            {{ unread_count }}
                        </span>
                    {% endif %}
                </button>

                <!-- Dropdown -->
                <div 
                    x-show="showNotif" 
                    x-transition:enter="transition ease-out duration-200"
                    x-transition:enter-start="opacity-0 transform scale-95"
                    x-transition:enter-end="opacity-100 transform scale-100"
                    x-transition:leave="transition ease-in duration-150"
                    x-transition:leave-start="opacity-100 transform scale-100"
                    x-transition:leave-end="opacity-0 transform scale-95"
                    @click.away="showNotif = false"
                    class="absolute right-0 mt-2 w-72 bg-white border border-gray-300 rounded-lg shadow-lg max-h-80 overflow-y-auto z-50"
                >


                    <ul id="notif-list" class="divide-y divide-gray-200">
                        {% for note in latest_notifications %}
                            <li id="note-{{ note.pk }}" class="p-3 {% if not note.is_read %}bg-gray-100 font-semibold{% endif %}">
                                <a href="{{ note.url|default:'#' }}" data-id="{{ note.pk }}" class="notif-link block">
                                    <div>{{ note.message }}</div>
                                    <small class="text-gray-500">{{ note.created_at|naturaltime }}</small>
                                </a>
                            </li>
                        {% empty %}
                            <li class="p-3 text-gray-500">No notifications</li>
                        {% endfor %}
                    </ul>

                    <div class="text-center p-2 border-t text-sm">
                        <a href="{% url 'notifications_list' %}" class="text-blue-600 hover:underline">View all</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="flex flex-1">

            <!-- Sidebar -->
            <aside
                class="fixed inset-y-0 left-0 w-56 p-4 bg-[#D1D5DB] border-r border-gray-300 flex flex-col 
                       transform transition-transform ease-in-out duration-300 
                       md:relative md:translate-x-0 md:flex z-50"
                :class="open ? 'translate-x-0' : '-translate-x-full'">

                <!-- Close button (mobile only) -->
                <button @click="open = false" class="self-end md:hidden mb-4 text-gray-600">âœ•</button>

                <div class="flex flex-col items-center">
                    {% if request.user.officer_photo %}
                        <img src="{{ request.user.officer_photo.url }}" alt="User Avatar"
                            class="w-24 h-24 sm:w-28 sm:h-28 object-cover rounded-full border-2 border-gray-300 mb-2">
                    {% else %}
                        <img src="{% static 'img/avatar-placeholder.png' %}" alt="User Avatar"
                            class="w-24 h-24 sm:w-28 sm:h-28 object-cover rounded-full border-2 border-gray-300 mb-2">
                    {% endif %}
                    <p class="font-medium text-gray-800 text-glow mb-4 text-sm sm:text-base text-center">
                        [{{ request.user.get_full_name|default:request.user.username }}]
                    </p>
                </div>

                <nav class="flex flex-col gap-2">
                    <a href="{% url 'dashboard' %}" class="px-3 py-2 rounded hover:bg-[#4B7289]/80 hover:text-white transition border-glow">
                        Dashboard
                    </a>
                    <a href="{% url 'report_list' %}" class="px-3 py-2 rounded hover:bg-[#4B7289]/80 hover:text-white transition border-glow">
                        Reports
                    </a>
                    <a href="{% url 'officer_list' %}" class="px-3 py-2 rounded hover:bg-[#4B7289]/80 hover:text-white transition border-glow">
                        Officers
                    </a>
                    <a href="{% url 'callers_list' %}" class="px-3 py-2 rounded hover:bg-[#4B7289]/80 hover:text-white transition border-glow">
                        Callers
                    </a>
                </nav>

                <form method="post" action="{% url 'logout' %}" class="mt-auto">
                    {% csrf_token %}
                    <button type="submit"
                        class="w-full bg-[#B91C1C] hover:bg-[#991B1B] text-white py-2 rounded border-glow transition">
                        Logout
                    </button>
                </form>
            </aside>

            <!-- Overlay for mobile -->
            <div x-show="open" @click="open = false" class="fixed inset-0 bg-black/40 md:hidden z-40"></div>

            <!-- Main Content -->
            <main class="flex-1 p-4 sm:p-8 space-y-4 sm:space-y-6">
                {% block content %}
                    <div class="p-4 sm:p-6 bg-white rounded-lg shadow-md border border-gray-300">
                        Your content goes here
                    </div>
                {% endblock %}
            </main>

        </div>

        <!-- Footer -->
        <footer class="bg-[#1B263B] text-white text-center py-2 border-t border-gray-300 text-glow text-sm sm:text-base">
            OneTapSOS<br>
            CMt 2025 (CMU)
        </footer>

    </div>

<script>
    window.NOTIFICATIONS_JSON_URL = "{% url 'notifications_json' %}";
</script>
<script src="{% static 'js/notifications.js' %}"></script>
</body>
</html>
