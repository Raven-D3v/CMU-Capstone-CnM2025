{% extends "base.html" %}
{% block title %}Officers List | OneTapSOS{% endblock %}

{% block content %}
<div class="p-6 space-y-6">
    <div class="flex justify-between items-center">
        <h2 class="text-2xl font-semibold text-gray-800 text-glow">POLICE OFFICERS</h2>
        <p class="text-gray-600"><strong>{% now "l, F j, Y - h:i A" %}</strong></p>
    </div>

 <!-- Filter/Search bar -->
<form method="get" class="flex flex-wrap gap-2 sm:gap-4 mb-6">
    <input type="text" name="q" placeholder="Search..." 
        value="{{ filters.q|default:'' }}"
        class="flex-1 min-w-[150px] p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-[#4B7289]">

    <select name="rank" class="p-2 border border-gray-300 rounded-md">
        <option value="">RANK</option>
        {% for r in ranks %}
            <option value="{{ r }}" {% if filters.rank == r %}selected{% endif %}>{{ r }}</option>
        {% endfor %}
    </select>

    <select name="designation" class="p-2 border border-gray-300 rounded-md">
        <option value="">DESIGNATION</option>
        {% for d in designations %}
            <option value="{{ d }}" {% if filters.designation == d %}selected{% endif %}>{{ d }}</option>
        {% endfor %}
    </select>

    <select name="area" class="p-2 border border-gray-300 rounded-md">
        <option value="">AREA VICINITY</option>
        {% for a in areas %}
            <option value="{{ a }}" {% if filters.area == a %}selected{% endif %}>{{ a }}</option>
        {% endfor %}
    </select>

    <select name="status" class="p-2 border border-gray-300 rounded-md">
        <option value="">STATUS</option>
        {% for s in statuses %}
            <option value="{{ s }}" {% if filters.status == s %}selected{% endif %}>{{ s|title }}</option>
        {% endfor %}
    </select>

    <button type="submit" class="px-4 py-2 bg-[#4B7289] text-white rounded hover:bg-[#6B7280] transition">
        Filter
    </button>
</form>


<!-- Officers List -->
{% if users %}
    <!-- Desktop / Tablet Table -->
    <div class="hidden sm:block overflow-x-auto">
        <table class="w-full min-w-[900px] border-collapse bg-white shadow-md">
            <thead>
                <tr class="bg-gray-100 text-sm sm:text-base">
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Police ID</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Rank</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Name</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Designation</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Area Vicinity</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Last Deployment</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Status</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Report (ID)</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Date Responded</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Date Resolved</th>
                    <th class="p-3 border-b border-gray-300 text-left font-semibold">Action</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr class="text-sm sm:text-base">
                    <td class="p-3 border-b">{{ user.police_id }}</td>
                    <td class="p-3 border-b">{{ user.rank }}</td>
                    <td class="p-3 border-b">{{ user.get_full_name }}</td>
                    <td class="p-3 border-b">{{ user.designation }}</td>
                    <td class="p-3 border-b">{{ user.area_vicinity }}</td>
                    <td class="p-3 border-b">{{ user.last_report_id|default:"--" }}</td>
                    <td class="p-3 border-b">{{ user.last_status|default:"--" }}</td>
                    <td class="p-3 border-b">{{ user.last_report_id|default:"--" }}</td>
                    <td class="p-3 border-b">{{ user.last_responded|date:"Y-m-d h:i A"|default:"--" }}</td>
                    <td class="p-3 border-b">{{ user.last_resolved|date:"Y-m-d h:i A"|default:"--" }}</td>
                    <td class="p-3 border-b">
                        <a href="{% url 'officer_view' user.id %}" class="inline-block px-3 py-1 bg-[#4B7289] text-white rounded hover:bg-[#6B7280] transition border-glow text-sm">VIEW</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Mobile Cards -->
    <div class="space-y-4 sm:hidden">
        {% for user in users %}
        <div class="bg-white p-4 rounded-lg shadow border border-gray-200">
            <div class="flex justify-between items-center mb-2">
                <h3 class="font-semibold text-gray-800">{{ user.get_full_name }}</h3>
                <span class="px-2 py-1 text-xs rounded bg-gray-100 text-gray-700">{{ user.rank }}</span>
            </div>
            <p class="text-sm text-gray-600"><strong>ID:</strong> {{ user.police_id }}</p>
            <p class="text-sm text-gray-600"><strong>Designation:</strong> {{ user.designation }}</p>
            <p class="text-sm text-gray-600"><strong>Area:</strong> {{ user.area_vicinity }}</p>
            <p class="text-sm text-gray-600"><strong>Last Deployment:</strong> {{ user.last_report_id|default:"--" }}</p>
            <p class="text-sm text-gray-600"><strong>Status:</strong> {{ user.last_status|default:"--" }}</p>
            <p class="text-sm text-gray-600"><strong>Report:</strong> {{ user.last_report_id|default:"--" }}</p>
            <p class="text-sm text-gray-600"><strong>Responded:</strong> {{ user.last_responded|date:"Y-m-d h:i A"|default:"--" }}</p>
            <p class="text-sm text-gray-600"><strong>Resolved:</strong> {{ user.last_resolved|date:"Y-m-d h:i A"|default:"--" }}</p>

            <div class="mt-3">
                <a href="{% url 'officer_view' user.id %}" 
                   class="inline-block w-full text-center px-4 py-2 bg-[#4B7289] text-white rounded hover:bg-[#6B7280] transition border-glow text-sm">
                   VIEW
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p class="text-gray-500">No officer data available.</p>
{% endif %}

</div>
{% endblock %}